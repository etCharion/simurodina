<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Rodinný rozpočet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"/>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        .container { max-width: 960px; }
        .section-title { position: sticky; top: 0; background-color: #e5e7eb; z-index: 10; }
        .evaluation-section, .details-section, .event-results { display: none; overflow: hidden; transition: all 0.3s ease-in-out; }
        .details-section.open, .event-results.open { display: block; }
        .hidden-item { display: none; }
        .disabled-button { cursor: not-allowed; opacity: 0.5; }
        .explanation-text { display: none; font-style: italic; color: #4b5563; margin-top: 8px; font-size: 0.875rem; }
        .dropdown-select { appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>'); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.2rem; padding-right: 2rem; }
        .tooltip-container { position: relative; display: inline-block; }
        .tooltip-text { visibility: hidden; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 5px 10px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -150px; opacity: 0; transition: opacity 0.3s; width: 300px; }
        .tooltip-text::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent; }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
        .question-icon { cursor: pointer; margin-left: 5px; font-weight: bold; }
        .disabled-item { opacity: 0.5; cursor: not-allowed; }
        .disabled-item input, .disabled-item select { pointer-events: none; }
        @media (min-width: 768px) { .income-events-section { display: flex; gap: 2rem; } .income-events-section > div { flex: 1; } }
    </style>
</head>
<body>
<div class="container mx-auto bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-gray-200">
  <!-- UI omitted for brevity; identical to previous -->
</div>
<script>
// Data (unchanged)
const budgetData = { /* ... full original data and arrays ... */ };
// Cache elements (unchanged)
const incomeSelect = document.getElementById('income-select');
const annualIncomeDisplay = document.getElementById('annual-income-display');
const annualExpensesDisplay = document.getElementById('annual-expenses');
const balanceDisplay = document.getElementById('balance');
const categoriesContainer = document.getElementById('categories-container');
const evaluateButton = document.getElementById('evaluate-button');
const evaluationSection = document.getElementById('evaluation-section');
const responsibilityScoreDisplay = document.getElementById('responsibility-score');
const comfortScoreDisplay = document.getElementById('comfort-score');
const totalScoreDisplay = document.getElementById('total-score');
const summaryToggle = document.getElementById('summary-toggle');
const detailsSection = document.getElementById('details-section');
const monthlyIncomeDetail = document.getElementById('monthly-income-detail');
const annualIncomeDetail = document.getElementById('annual-income-detail');
const monthlyExpensesDetail = document.getElementById('monthly-expenses-detail');
const oneTimeExpensesDetail = document.getElementById('one-time-expenses-detail');
const totalAnnualExpensesDetail = document.getElementById('total-annual-expenses-detail');
const balanceDetail = document.getElementById('balance-detail');
const eventsToggle = document.getElementById('events-toggle');
const eventsSection = document.getElementById('events-section');
const maxEventsSelect = document.getElementById('max-events');
const rollEventsButton = document.getElementById('roll-events-button');
const eventsList = document.getElementById('events-list');
let selectedItems = {};
let initialMonthlyIncome = 0;
let currentMonthlyIncome = 0;

function checkFormValidity() {
  let allSingleSelected = true;
  budgetData.categories.forEach((category, catIndex) => {
    if (category.selection === 'single') {
      const isSelected = document.querySelector(`input[name="category-${catIndex}"]:checked`);
      if (!isSelected) allSingleSelected = false;
    }
  });
  if (allSingleSelected && budgetData.balance >= 0) {
    evaluateButton.disabled = false;
    evaluateButton.classList.remove('disabled-button');
    evaluateButton.classList.add('hover:bg-indigo-700');
  } else {
    evaluateButton.disabled = true;
    evaluateButton.classList.add('disabled-button');
    evaluateButton.classList.remove('hover:bg-indigo-700');
  }
}

function calculateBudget() {
  let totalMonthlyCost = 0;
  let totalOneTimeCost = 0;
  let totalComfort = 0;
  let totalResponsibility = 0;
  let tempMonthlyCost = 0;
  let tempOneTimeCost = 0;
  selectedItems = {};
  currentMonthlyIncome = initialMonthlyIncome;
  let hasDeathEvent = false;
  const selectedIncomeOption = incomeSelect.options[incomeSelect.selectedIndex];
  const husbandIncome = parseFloat(selectedIncomeOption.dataset.husband);
  const wifeIncome = parseFloat(selectedIncomeOption.dataset.wife);
  const selectedEvents = Array.from(document.querySelectorAll('input[name="random-event"]:checked')).map(checkbox => {
    const eventIndex = parseInt(checkbox.value, 10);
    return budgetData.randomEvents[eventIndex];
  });
  hasDeathEvent = selectedEvents.some(event => event.type === 'death');
  // ... rest of original logic computing totals ...
  // At the end compute balance
  const totalAnnualIncome = currentMonthlyIncome * 12;
  const totalAnnualCost = (totalMonthlyCost * 12) + totalOneTimeCost;
  const balance = totalAnnualIncome - totalAnnualCost;
  budgetData.balance = balance; // NEW: persist balance for validity checks
  // update UI (unchanged)
  annualIncomeDisplay.textContent = Math.round(totalAnnualIncome).toLocaleString('cs-CZ');
  annualExpensesDisplay.textContent = Math.round(totalAnnualCost).toLocaleString('cs-CZ');
  balanceDisplay.textContent = Math.round(balance).toLocaleString('cs-CZ');
  balanceDisplay.classList.remove('text-green-600', 'text-red-600');
  balanceDisplay.classList.add(balance >= 0 ? 'text-green-600' : 'text-red-600');
  // ... rest of original UI updates ...
  checkFormValidity();
}

// event listeners and init (unchanged)
</script>
</body>
</html>
